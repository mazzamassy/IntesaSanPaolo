"use-strict";var resizeIframe=function(a,b,c){var d;if(c&&""!==c&&(d=$('[name="'+c+'"]')[0]),d){console.info("RESIZE IFRAME (id: "+c+" - iframe: "+d.id+")"),console.info("RESIZE IFRAME (previous "+d.style.height+") - API onresize | "+b+": "+a+"px");var e=50,f=d.style.height;if(""===f||f&&(a-parseInt(f.substring(0,f.indexOf("px")))>0||a-parseInt(f.substring(0,f.indexOf("px")))<0))if(("ifrmAccessRollout"===c||"iframePageLogin"===c)&&window.outerWidth>768)d.style.height=a+"px";else if("cmsModalIframe"===c&&a>500){var g=d.contentDocument||d.contentWindow.document;if(g)var h=g.getElementById("bodyIntesa");h&&(h.style.overflow="scroll"),a=500,d.style.height=a+e+"px",console.info("RESIZE IFRAME (previous "+d.style.height+") - cmsModalIframe more then 500px | "+b+": "+a+"px");var i;i=top.document.getElementById("archModal"),i&&(i.style.overflow="hidden")}else d.style.height=a+e+"px"}},resizeCustomerFeedbackIframe=resizeIframe,resizeMerchantIframe=resizeIframe,getUrl=function(){var a=window.location.origin;return window.location.origin||(a=window.location.protocol+"//"+window.location.hostname+(window.location.port?":"+window.location.port:"")),a+window.location.pathname},changeTitle=function(a){top.broadcastEvent("ARCH_PAGE_INFO_CHANGED",{forcePageTitle:a,overrideStatePageTitle:!0})},triggerSessionKO=function(){top.goToSessionKOPageStaticMessage()},ndceNavigate=function(a,b){top.goTo(a,null,null,null,b)},initStyles=function(a){var b;b=a&&""!==a?$("#"+a):$("iframe"),b&&b.contents().find("head").append('<link href="css/ArchIbPublicStyle.css" rel="stylesheet" type="text/css"></link>')},OWNER_IB="IB",OWNER_FIDEURAM="FOL",OWNER_MC2="MC2",OWNER_MONEYMATE="MM",ABI_FIDEURAM="03296",urlSessioneNDCE="/ib/content/api/arch/common/keepalive.gif",urlSessioneIB="/script/ndce/allSessionsKeeper.gif",urlSessioneSSB="/scriptIbif0/WebAppQuotations/allSessionsKeeper.gif",keepAliveAllSession=function(a){window.console.log("Test Keepalive"),callAiax(top.urlSessioneNDCE+"?"),a==OWNER_IB&&top.isSessionSSBActive&&callAiax(top.urlSessioneSSB+"?"),a==OWNER_FIDEURAM&&(top.isSessionSSBActive&&callAiax(top.urlSessioneSSB+"?"),callAiax(top.urlSessioneIB+"?")),a==OWNER_MONEYMATE&&(top.isSessionSSBActive&&callAiax(top.urlSessioneSSB+"?"),callAiax(top.urlSessioneIB+"?")),a==OWNER_MC2&&(top.isSessionSSBActive=!0,callAiax(top.urlSessioneIB+"?"))},callAiax=function(a){var b=a;a.indexOf("?")===a.length-1&&(b=a.replace("?","")),a=a+"&time="+(new Date).getTime();var c=window.sessionStorage.getItem("_env");c&&b===urlSessioneNDCE&&(a=c+a);var d=null,e=window.sessionStorage.getItem("ACCESS-TOKEN");try{d=JSON.parse(e)}catch(f){console.warn("access token is not a JSON",f),d=e}var g={Authorization:"Bearer "+d};$.ajax({type:"GET",cache:!1,timeout:3e5,url:a,headers:g,xhrFields:{withCredentials:!0},dataType:"html",beforeSend:function(){},error:function(a,b,c){var d=JSON.parse(a.responseText);if(broadcastEvent("KEEPALIVE_STOPPED",{}),"SESSION_DELETED"===d.message){var e={message:"Sei connesso alla tua banca online con un altro dispositivo.<br/>Per garantirti massima sicurezza, puoi utilizzare una sola connessione protetta alla volta.",messageSeverity:"FATAL",messageTitle:"Sessione interrotta",retry:!0,faceClass:"isp-messageFatal-icon isp-font-cf-face-bad-n",type:"SESSION_DELETED"};top.goToSessionKOPage(e,null)}else triggerSessionKO()},success:function(a,b,c){var d=c.getResponseHeader("authorization");if(d){window.sessionStorage.setItem("ACCESS-TOKEN",d.replace("Bearer ",""));var e=JSON.parse(window.sessionStorage.getItem("ARKHTTPHEADER"));e.Authorization=d,window.sessionStorage.setItem("ARKHTTPHEADER",JSON.stringify(e)),window.commonHeader.Authorization=d}},complete:function(){}})};window.addEventListener("message",function(a){if(~a.origin.indexOf("https://surveys.intesasanpaolo.com")){if(a&&a.data&&a.data.event)switch(a.data.event){case"resize":resizeCustomerFeedbackIframe(a.data.height,a.data.url,a.data.id);break;case"setState":setCustomerFeedbackState(a.data.data,a.data.isRicordamiDi,a.data.titoloSurvey);break;case"resizeCustomerFeedback":setCustomerFeedbackHeight(a.data.data)}}else{if(!(~a.origin.indexOf("https://test-isprushandwin.serisystem.com")||~a.origin.indexOf("https://reward-isp.serijakala.it")||~a.origin.indexOf("https://intesa.mmn.it")||~a.origin.indexOf("https://intesasystem.mmn.it")||~a.origin.indexOf("https://stage-ispvenditadiretta.serisystem.com")||~a.origin.indexOf("https://ispvenditadiretta.jakala.it")||~a.origin.indexOf("https://stage-ispvenditadiretta.jakala.it")||~a.origin.indexOf("https://intesa-test.mmn.it")||~a.origin.indexOf("https://services.jakala.com")||~a.origin.indexOf("https://samesite-iframe.jakala.it")||~a.origin.indexOf("https://stage.jakala.it")||~a.origin.indexOf("https://tcdil0.syssede.systest.sanpaoloimi.com")&&disableSSOMerchant))return;if(a&&a.data&&a.data.event)switch(a.data.event){case"RESIZE":a.data.newHeight?resizeMerchantIframe(a.data.newHeight,a.data.iframeId,a.data.iframeId):console.error("No height was provided");break;case"SELECT_CONTACT":broadcastEvent("MERCHANT_SELECT_CONTACT",{previousSelectedContacts:a.data.previousSelectedContacts});break;case"MODIFY_PRODUCT":broadcastEvent("MERCHANT_MODIFY_PRODUCT",{productOptions:a.data.productOptions});break;case"CART_FINALISED":a.data&&a.data.cart&&a.data.cart.origin&&"nmspintervista"===a.data.cart.origin.statename?broadcastEvent("MERCHANT_NAVIGATE_CJ_LOAN",{cart:a.data.cart}):broadcastEvent("MERCHANT_NAVIGATE_CART",{cart:a.data.cart});break;case"KEEP_ALIVE":keepAliveAllSession();break;case"IMMEDIATE_KEEP_ALIVE":callAiax(top.urlSessioneNDCE+"?");break;case"GO_TO":goTo(a.data.stateName,a.data.params,a.data.options,a.data.payloadArg);break;case"GO_HOMEPAGE":goTo("homepage",a.data.params,a.data.options,a.data.payloadArg);break;case"SCROLL":window.scrollTo(0,a.data.offset);break;case"INIT_STORE":broadcastEvent("MERCHANT_STORE_INIT",{exitCode:a.data.exitCode});break;case"TEALIUM_TRACK":console.debug("TEALIUM_TRACK",a.data.data),broadcastEvent("TEALIUM_TRACK_STORE",{data:a.data.data})}}});